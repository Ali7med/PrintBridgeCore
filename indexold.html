<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Print Server - لوحة التحكم</title>
    <meta name="description" content="لوحة تحكم سيرفر الطباعة - إدارة الطباعة والإعدادات">
    <link rel="stylesheet" href="style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <!-- Sidebar -->
    <aside class="sidebar">
        <div class="logo">
            <svg width="40" height="40" viewBox="0 0 40 40" fill="none">
                <rect width="40" height="40" rx="8" fill="url(#gradient)"/>
                <path d="M12 16h16M12 20h16M12 24h10" stroke="white" stroke-width="2" stroke-linecap="round"/>
                <defs>
                    <linearGradient id="gradient" x1="0" y1="0" x2="40" y2="40">
                        <stop offset="0%" stop-color="#667eea"/>
                        <stop offset="100%" stop-color="#764ba2"/>
                    </linearGradient>
                </defs>
            </svg>
            <h1>Print Server</h1>
        </div>
        
        <nav class="nav">
            <a href="#dashboard" class="nav-item active" data-page="dashboard">
                <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                    <path d="M3 4a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1V4zM3 10a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H4a1 1 0 01-1-1v-6zM14 9a1 1 0 00-1 1v6a1 1 0 001 1h2a1 1 0 001-1v-6a1 1 0 00-1-1h-2z"/>
                </svg>
                <span>لوحة التحكم</span>
            </a>
            
            <a href="#settings" class="nav-item" data-page="settings">
                <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M11.49 3.17c-.38-1.56-2.6-1.56-2.98 0a1.532 1.532 0 01-2.286.948c-1.372-.836-2.942.734-2.106 2.106.54.886.061 2.042-.947 2.287-1.561.379-1.561 2.6 0 2.978a1.532 1.532 0 01.947 2.287c-.836 1.372.734 2.942 2.106 2.106a1.532 1.532 0 012.287.947c.379 1.561 2.6 1.561 2.978 0a1.533 1.533 0 012.287-.947c1.372.836 2.942-.734 2.106-2.106a1.533 1.533 0 01.947-2.287c1.561-.379 1.561-2.6 0-2.978a1.532 1.532 0 01-.947-2.287c.836-1.372-.734-2.942-2.106-2.106a1.532 1.532 0 01-2.287-.947zM10 13a3 3 0 100-6 3 3 0 000 6z" clip-rule="evenodd"/>
                </svg>
                <span>الإعدادات</span>
            </a>
            
            <a href="#token" class="nav-item" data-page="token">
                <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M5 9V7a5 5 0 0110 0v2a2 2 0 012 2v5a2 2 0 01-2 2H5a2 2 0 01-2-2v-5a2 2 0 012-2zm8-2v2H7V7a3 3 0 016 0z" clip-rule="evenodd"/>
                </svg>
                <span>التوكن</span>
            </a>
            
            <a href="#history" class="nav-item" data-page="history">
                <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"/>
                </svg>
                <span>سجل الطباعة</span>
            </a>
        </nav>
        
        <div class="sidebar-footer">
            <div class="status-indicator">
                <div class="status-dot"></div>
                <span>الخدمة نشطة</span>
            </div>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Dashboard Page -->
        <div id="page-dashboard" class="page active">
            <header class="page-header">
                <h2>لوحة التحكم</h2>
                <p class="subtitle">نظرة عامة على نشاط الطباعة</p>
            </header>

            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="white">
                            <path d="M19 8H5c-1.66 0-3 1.34-3 3v6h4v4h12v-4h4v-6c0-1.66-1.34-3-3-3zm-3 11H8v-5h8v5zm3-7c-.55 0-1-.45-1-1s.45-1 1-1 1 .45 1 1-.45 1-1 1zm-1-9H6v4h12V3z"/>
                        </svg>
                    </div>
                    <div class="stat-content">
                        <h3 id="total-prints">0</h3>
                        <p>إجمالي المهام</p>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-icon" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="white">
                            <path d="M9 16.2L4.8 12l-1.4 1.4L9 19 21 7l-1.4-1.4L9 16.2z"/>
                        </svg>
                    </div>
                    <div class="stat-content">
                        <h3 id="success-prints">0</h3>
                        <p>مهام ناجحة</p>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-icon" style="background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="white">
                            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"/>
                        </svg>
                    </div>
                    <div class="stat-content">
                        <h3 id="failed-prints">0</h3>
                        <p>مهام فاشلة</p>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-icon" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="white">
                            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                        </svg>
                    </div>
                    <div class="stat-content">
                        <h3 id="active-printers">0</h3>
                        <p>طابعات نشطة</p>
                    </div>
                </div>
            </div>

            <div class="content-grid">
                <div class="card">
                    <div class="card-header">
                        <h3>الطابعات المتاحة</h3>
                        <button class="btn-refresh" onclick="loadPrinters()">
                            <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                                <path d="M8 3a5 5 0 104.546 2.914.5.5 0 01.908-.417A6 6 0 118 2v1z"/>
                                <path d="M8 4.466V.534a.25.25 0 01.41-.192l2.36 1.966c.12.1.12.284 0 .384L8.41 4.658A.25.25 0 018 4.466z"/>
                            </svg>
                        </button>
                    </div>
                    <div id="printers-list" class="printers-list">
                        <div class="loading">جاري التحميل...</div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3>آخر المهام</h3>
                    </div>
                    <div id="recent-jobs" class="recent-jobs">
                        <div class="loading">جاري التحميل...</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Settings Page -->
        <div id="page-settings" class="page">
            <header class="page-header">
                <h2>الإعدادات</h2>
                <p class="subtitle">إدارة إعدادات الطباعة والاتصال</p>
            </header>

            <div class="settings-container">
                <form id="settings-form" class="settings-form">
                    <div class="form-section">
                        <h3>إعدادات الطابعة</h3>
                        
                        <div class="form-group">
                            <label for="default-printer">الطابعة الافتراضية</label>
                            <select id="default-printer" name="defaultPrinter">
                                <option value="">جاري التحميل...</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-section">
                        <h3>إعدادات RAW/ZPL</h3>
                        
                        <div class="form-group">
                            <label for="raw-mode">طريقة RAW</label>
                            <select id="raw-mode" name="rawMode">
                                <option value="winspool">Winspool</option>
                                <option value="tcp">TCP Direct</option>
                            </select>
                        </div>

                        <div class="form-group" id="tcp-settings">
                            <label for="tcp-host">عنوان IP</label>
                            <input type="text" id="tcp-host" name="rawTcpHost" placeholder="192.168.1.50">
                        </div>

                        <div class="form-group" id="tcp-port-group">
                            <label for="tcp-port">المنفذ</label>
                            <input type="number" id="tcp-port" name="rawTcpPort" value="9100">
                        </div>

                        <div class="form-group">
                            <label for="raw-encoding">الترميز</label>
                            <select id="raw-encoding" name="rawEncoding">
                                <option value="utf-8">UTF-8</option>
                                <option value="ansi">ANSI</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="raw-terminator">Terminator</label>
                            <input type="text" id="raw-terminator" name="rawTerminator" placeholder="^XZ">
                        </div>
                    </div>

                    <div class="form-section">
                        <h3>إعدادات الأمان</h3>
                        
                        <div class="form-group checkbox-group">
                            <label>
                                <input type="checkbox" id="allow-local" name="allowLocalNoToken">
                                <span>السماح بالطلبات المحلية بدون توكن</span>
                            </label>
                        </div>

                        <div class="form-group">
                            <label for="max-file-size">الحد الأقصى لحجم الملف (MB)</label>
                            <input type="number" id="max-file-size" name="maxFileSizeMb" value="20" min="1" max="100">
                        </div>
                    </div>

                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary">حفظ التغييرات</button>
                        <button type="button" class="btn btn-secondary" onclick="loadSettings()">إلغاء</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Token Page -->
        <div id="page-token" class="page">
            <header class="page-header">
                <h2>إدارة التوكن</h2>
                <p class="subtitle">توليد وإدارة توكن الأمان للوصول إلى API</p>
            </header>

            <div class="token-container">
                <div class="card token-card">
                    <div class="token-display" id="token-display">
                        <div class="loading">جاري التحميل...</div>
                    </div>

                    <div class="token-actions">
                        <button class="btn btn-primary" onclick="generateToken()">
                            <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                                <path d="M8 3a5 5 0 104.546 2.914.5.5 0 01.908-.417A6 6 0 118 2v1z"/>
                            </svg>
                            توليد توكن جديد
                        </button>
                        <button class="btn btn-danger" onclick="disableToken()">
                            <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                                <path d="M5.5 5.5A.5.5 0 016 6v6a.5.5 0 01-1 0V6a.5.5 0 01.5-.5zm2.5 0a.5.5 0 01.5.5v6a.5.5 0 01-1 0V6a.5.5 0 01.5-.5zm3 .5a.5.5 0 00-1 0v6a.5.5 0 001 0V6z"/>
                                <path fill-rule="evenodd" d="M14.5 3a1 1 0 01-1 1H13v9a2 2 0 01-2 2H5a2 2 0 01-2-2V4h-.5a1 1 0 01-1-1V2a1 1 0 011-1H6a1 1 0 011-1h2a1 1 0 011 1h3.5a1 1 0 011 1v1zM4.118 4L4 4.059V13a1 1 0 001 1h6a1 1 0 001-1V4.059L11.882 4H4.118zM2.5 3V2h11v1h-11z"/>
                            </svg>
                            تعطيل التوكن
                        </button>
                    </div>
                </div>

                <div class="card info-card">
                    <h3>كيفية الاستخدام</h3>
                    <div class="info-content">
                        <p>لاستخدام API من أجهزة الشبكة، أضف التوكن في Header:</p>
                        <div class="code-block">
                            <code>X-Print-Token: <span id="token-example">your-token-here</span></code>
                            <button class="btn-copy" onclick="copyToken()">
                                <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                                    <path d="M4 2a2 2 0 012-2h8a2 2 0 012 2v8a2 2 0 01-2 2H6a2 2 0 01-2-2V2z"/>
                                    <path d="M2 5a2 2 0 00-2 2v6a2 2 0 002 2h8a2 2 0 002-2v-1h-1v1a1 1 0 01-1 1H2a1 1 0 01-1-1V7a1 1 0 011-1h1V5H2z"/>
                                </svg>
                            </button>
                        </div>
                        <p class="info-note">⚠️ احتفظ بالتوكن في مكان آمن ولا تشاركه مع الآخرين</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- History Page -->
        <div id="page-history" class="page">
            <header class="page-header">
                <h2>سجل الطباعة</h2>
                <p class="subtitle">عرض وتصفية سجل مهام الطباعة</p>
            </header>

            <div class="history-filters">
                <div class="filter-group">
                    <label for="filter-status">الحالة</label>
                    <select id="filter-status">
                        <option value="">الكل</option>
                        <option value="success">ناجح</option>
                        <option value="failed">فاشل</option>
                        <option value="queued">في الانتظار</option>
                    </select>
                </div>

                <div class="filter-group">
                    <label for="filter-printer">الطابعة</label>
                    <select id="filter-printer">
                        <option value="">الكل</option>
                    </select>
                </div>

                <button class="btn btn-primary" onclick="loadHistory()">
                    <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                        <path fill-rule="evenodd" d="M8 3a5 5 0 104.546 2.914.5.5 0 01.908-.417A6 6 0 118 2v1z"/>
                    </svg>
                    تحديث
                </button>
            </div>

            <div class="card">
                <div id="history-table-container">
                    <div class="loading">جاري التحميل...</div>
                </div>
            </div>
        </div>
    </main>

    <!-- Toast Notifications -->
    <div id="toast-container" class="toast-container"></div>

    <script src="app.js"></script>
</body>
</html>
